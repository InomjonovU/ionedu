{% extends 'student/base.html' %}

{% block title %}Kurslar - IonEdu{% endblock %}

{% block content %}
<style>
    /* Page Container */
    .courses-page {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    /* Header */
    .page-header {
        margin-bottom: 40px;
        animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .page-title {
        font-size: 48px;
        font-weight: 900;
        color: var(--gray-900);
        margin-bottom: 12px;
    }

    .page-subtitle {
        font-size: 18px;
        color: #6b7280;
    }

    /* Filters */
    .filters {
        background: white;
        padding: 24px;
        border-radius: 16px;
        margin-bottom: 40px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .filter-row {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 16px;
        margin-bottom: 16px;
    }

    .filter-input {
        padding: 14px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        font-size: 15px;
        font-family: inherit;
        transition: all 0.2s;
        background: white;
    }

    .filter-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
    }

    select.filter-input {
        cursor: pointer;
    }

    .filter-buttons {
        display: flex;
        gap: 12px;
    }

    .btn {
        padding: 14px 28px;
        border: none;
        border-radius: 10px;
        font-weight: 700;
        font-size: 15px;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .btn-secondary {
        background: white;
        color: #6b7280;
        border: 2px solid #e5e7eb;
    }

    .btn-secondary:hover {
        border-color: var(--primary);
        color: var(--primary);
    }

    /* Courses Grid */
    .courses-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 24px;
    }

    /* Course Card */
    .course-card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        transition: all 0.3s;
        animation: fadeUp 0.6s ease both;
    }

    @keyframes fadeUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .course-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    }

    .course-image {
        width: 100%;
        height: 180px;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .course-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .course-icon {
        font-size: 60px;
        color: white;
        opacity: 0.9;
    }

    .course-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        background: white;
        color: var(--primary);
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
    }

    .course-body {
        padding: 20px;
    }

    .course-meta {
        display: flex;
        gap: 12px;
        margin-bottom: 12px;
        font-size: 13px;
        color: #9ca3af;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .course-title {
        font-size: 20px;
        font-weight: 800;
        color: var(--gray-900);
        margin-bottom: 10px;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .course-description {
        font-size: 14px;
        color: #6b7280;
        line-height: 1.6;
        margin-bottom: 16px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .course-teacher {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px;
        background: var(--gray-50);
        border-radius: 10px;
        margin-bottom: 16px;
    }

    .teacher-avatar {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 14px;
    }

    .teacher-name {
        font-weight: 700;
        color: var(--gray-900);
        font-size: 14px;
    }

    .teacher-title {
        font-size: 12px;
        color: #9ca3af;
    }

    .course-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .course-stats {
        display: flex;
        gap: 16px;
        font-size: 13px;
        color: #6b7280;
    }

    .stat {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .btn-view {
        padding: 10px 20px;
        background: var(--primary);
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 700;
        font-size: 14px;
        transition: all 0.2s;
    }

    .btn-view:hover {
        background: var(--primary-dark);
        transform: translateX(4px);
    }

    /* Empty State */
    .empty {
        text-align: center;
        padding: 80px 20px;
        grid-column: 1 / -1;
    }

    .empty i {
        font-size: 80px;
        color: #e5e7eb;
        margin-bottom: 20px;
    }

    .empty h3 {
        font-size: 24px;
        font-weight: 700;
        color: #6b7280;
        margin-bottom: 8px;
    }

    .empty p {
        color: #9ca3af;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .page-title {
            font-size: 36px;
        }

        .filter-row {
            grid-template-columns: 1fr;
        }

        .filter-buttons {
            flex-direction: column;
        }

        .courses-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 480px) {
        .courses-page {
            padding: 20px 16px;
        }

        .page-title {
            font-size: 28px;
        }

        .filters {
            padding: 20px;
        }

        .course-body {
            padding: 16px;
        }
    }
</style>

<div class="courses-page">
    <!-- Header -->
    <div class="page-header">
        <h1 class="page-title">Barcha Kurslar</h1>
        <p class="page-subtitle">O'zingizga mos kursni tanlang va bilim olishni boshlang</p>
    </div>

    <!-- Filters -->
    <div class="filters">
        <form id="filterForm">
            <div class="filter-row">
                <input
                    type="text"
                    id="searchInput"
                    class="filter-input"
                    placeholder="ðŸ” Qidirish..."
                    value="{{ request.GET.search }}"
                >
                <select id="categoryFilter" class="filter-input">
                    <option value="">Kategoriya</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
                <select id="gradeFilter" class="filter-input">
                    <option value="">Sinf</option>
                    {% for i in "123456789"|make_list %}
                    <option value="{{ i }}" {% if request.GET.grade == i %}selected{% endif %}>{{ i }}-sinf</option>
                    {% endfor %}
                    {% for i in "01"|make_list %}
                    <option value="1{{ i }}" {% if request.GET.grade == "1"|add:i %}selected{% endif %}>1{{ i }}-sinf</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-buttons">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-filter"></i>
                    Filterlash
                </button>
                <button type="button" class="btn btn-secondary" onclick="resetFilters()">
                    <i class="fas fa-undo"></i>
                    Tozalash
                </button>
            </div>
        </form>
    </div>

    <!-- Courses Grid -->
    <div class="courses-grid">
        {% for course in courses %}
        <div class="course-card" style="animation-delay: {{ forloop.counter0|floatformat:"1" }}00ms">
            <div class="course-image">
                {% if course.background_image %}
                    <img src="{{ course.background_image.url }}" alt="{{ course.title }}">
                {% else %}
                    <i class="fas fa-book-open course-icon"></i>
                {% endif %}
                <span class="course-badge">OCHIQ</span>
            </div>

            <div class="course-body">
                <div class="course-meta">
                    {% if course.subject %}
                    <div class="meta-item">
                        <i class="fas fa-book"></i>
                        {{ course.subject }}
                    </div>
                    {% endif %}
                    {% if course.grade %}
                    <div class="meta-item">
                        <i class="fas fa-graduation-cap"></i>
                        {{ course.grade }}-sinf
                    </div>
                    {% endif %}
                </div>

                <h3 class="course-title">{{ course.title }}</h3>

                {% if course.description %}
                <p class="course-description">{{ course.description }}</p>
                {% endif %}

                <div class="course-teacher">
                    <div class="teacher-avatar">
                        {{ course.teacher.first_name.0|upper }}{{ course.teacher.last_name.0|upper|default:'' }}
                    </div>
                    <div>
                        <div class="teacher-name">{{ course.teacher.get_full_name }}</div>
                        <div class="teacher-title">O'qituvchi</div>
                    </div>
                </div>

                <div class="course-footer">
                    <div class="course-stats">
                        <div class="stat">
                            <i class="fas fa-users"></i>
                            {{ course.students_count|default:0 }}
                        </div>
                        <div class="stat">
                            <i class="fas fa-book-reader"></i>
                            {{ course.lessons_count|default:0 }} dars
                        </div>
                    </div>
                    <a href="{% url 'student:course_detail' course.id %}" class="btn-view">
                        Ko'rish
                    </a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="empty">
            <i class="fas fa-inbox"></i>
            <h3>Kurslar topilmadi</h3>
            <p>Filtrlarni o'zgartiring yoki keyinroq qaytib keling</p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    // Filter form
    document.getElementById('filterForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const search = document.getElementById('searchInput').value;
        const category = document.getElementById('categoryFilter').value;
        const grade = document.getElementById('gradeFilter').value;

        const params = new URLSearchParams();
        if (search) params.append('search', search);
        if (category) params.append('category', category);
        if (grade) params.append('grade', grade);

        window.location.href = `{% url 'student:courses' %}?${params.toString()}`;
    });

    function resetFilters() {
        window.location.href = '{% url 'student:courses' %}';
    }
</script>

{% endblock %}